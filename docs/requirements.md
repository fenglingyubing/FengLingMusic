# FLMusic 音乐软件需求文档

## 1. 项目概述

### 1.1 项目名称
FLMusic - 跨平台音乐播放器

### 1.2 项目简介
一款支持 Windows 和 Android 双平台的现代化音乐播放软件，提供本地音乐播放、在线音乐搜索、歌词显示等功能，致力于为用户提供优质的音乐体验。

### 1.3 目标用户
- 喜欢听音乐的普通用户
- 需要管理本地音乐库的用户
- 追求简洁美观界面的用户
- 需要跨平台同步的用户

### 1.4 支持平台
- **Windows**: Windows 10/11 (x64)
- **Android**: Android 8.0 及以上版本

---

## 2. 功能需求

### 2.1 核心播放功能

#### 2.1.1 基础播放控制
- **播放/暂停**: 点击按钮控制音乐播放和暂停
- **上一曲/下一曲**: 快速切换歌曲
- **进度条控制**: 拖动进度条跳转到指定位置
- **音量控制**: 调节音量大小（0-100%）
- **播放模式**:
  - 顺序播放
  - 单曲循环
  - 随机播放
  - 列表循环

#### 2.1.2 音频格式支持
- MP3
- FLAC (无损)
- WAV
- AAC/M4A
- OGG
- APE

#### 2.1.3 音效设置
- 均衡器（预设多种音效模式）
- 淡入淡出效果
- 音量正常化

### 2.2 音乐库管理

#### 2.2.1 本地音乐扫描
- 自动扫描指定文件夹
- 手动添加音乐文件/文件夹
- 支持拖拽添加音乐
- 自动识别音乐信息（标题、艺术家、专辑、时长等）

#### 2.2.2 音乐分类
- 按艺术家分类
- 按专辑分类
- 按文件夹分类
- 最近播放
- 最常播放

#### 2.2.3 播放列表
- 创建自定义播放列表
- 编辑播放列表（添加/删除歌曲）
- 删除播放列表
- 导出/导入播放列表（M3U/M3U8格式）

#### 2.2.4 收藏功能
- 收藏喜欢的歌曲
- 快速访问收藏列表

### 2.3 在线功能

#### 2.3.1 音乐搜索
- 支持多平台搜索（网易云音乐、QQ音乐、酷狗音乐等）
- 搜索结果展示（歌曲名、艺术家、专辑、时长）
- 搜索历史记录

#### 2.3.2 在线播放
- 支持在线试听
- 自动缓存播放音乐

#### 2.3.3 音乐下载
- 下载在线音乐到本地
- 选择音质（标准、高品质、无损）
- 下载队列管理
- 断点续传

#### 2.3.4 歌词功能
- 在线获取歌词
- 本地歌词文件读取（LRC格式）
- 逐行高亮显示
- 歌词翻译显示
- 桌面歌词（Windows）
- 锁屏歌词（Android）

### 2.4 用户界面

#### 2.4.1 主界面布局
- **播放控制栏**: 底部固定，显示当前播放信息和控制按钮
- **侧边栏**: 音乐库、播放列表、收藏夹等导航
- **主内容区**: 显示歌曲列表、专辑详情等
- **搜索栏**: 顶部快速搜索

#### 2.4.2 主题设置
- 浅色模式
- 深色模式
- 跟随系统
- 自定义主题颜色

#### 2.4.3 可视化效果
- 专辑封面显示
- 播放动画效果
- 频谱可视化（可选）

#### 2.4.4 动画与交互
- **页面切换动画**: 平滑的页面过渡效果（淡入淡出、滑动等）
- **列表滚动**: 流畅的列表滚动体验，支持惯性滚动
- **按钮反馈**: 点击、悬停等交互的视觉反馈动画
- **播放进度**: 进度条拖动、音量调节等操作的平滑过渡
- **专辑封面**: 切歌时的封面切换动画（翻转、淡入淡出等）
- **歌词滚动**: 歌词逐行滚动的平滑动画
- **加载状态**: 优雅的加载动画（skeleton、spinner 等）
- **手势动画**: 滑动切歌、上拉下拉等手势的跟手动画
- **微交互**: 收藏、添加到播放列表等操作的微动画反馈
- **动画性能**: 所有动画保持 120 FPS，支持高刷新率屏幕，确保极致流畅体验

### 2.5 跨平台特性

#### 2.5.1 数据同步
- 播放列表同步
- 收藏歌曲同步
- 播放历史同步
- 设置同步

#### 2.5.2 平台特定功能

**Windows 端**:
- 系统托盘图标
- 全局快捷键
- 桌面歌词
- 媒体键支持
- Windows 任务栏集成
- 支持高刷新率显示器（120Hz/144Hz/165Hz）

**Android 端**:
- 后台播放服务
- 通知栏控制
- 锁屏控制
- 桌面小部件
- 耳机线控支持
- 自动暂停（来电、拔耳机等）
- 高刷新率屏幕优化（90Hz/120Hz/144Hz）

### 2.6 其他功能

#### 2.6.1 搜索功能
- 本地音乐搜索
- 快速定位歌曲

#### 2.6.2 设置选项
- 语言设置（中文、英文）
- 音乐扫描路径设置
- 下载路径设置
- 缓存清理
- 数据备份与恢复

#### 2.6.3 信息显示
- 当前播放歌曲详细信息
- 文件属性（码率、采样率、格式等）
- 播放统计（总时长、播放次数等）

---

## 3. 非功能需求

### 3.1 性能要求
- 应用启动时间 < 3秒
- 音乐切换响应时间 < 500ms
- 支持大型音乐库（10000+ 歌曲）流畅运行
- 内存占用合理（Windows < 200MB，Android < 150MB 空闲状态）
- **高刷新率支持**:
  - 支持 60Hz/90Hz/120Hz/144Hz 刷新率屏幕
  - 自动检测并适配设备最高刷新率
  - 在高刷新率下保持稳定帧率（无掉帧）
  - GPU 占用率 < 30%（动画播放时）
  - 渲染延迟 < 8ms（120Hz 标准）

### 3.2 用户体验
- 界面简洁美观，符合现代设计语言
- 操作流畅，无明显卡顿
- 提供必要的操作反馈
- 错误提示友好清晰
- **动画流畅性**: 所有过渡动画和交互动画必须平滑流畅
  - 页面切换动画时长 200-300ms
  - 列表滚动帧率稳定在 120 FPS（支持高刷新率屏幕）
  - 手势操作实时跟手，延迟 < 8ms（120Hz 下单帧时间）
  - 动画曲线自然（使用缓动函数如 ease-in-out）
  - 避免动画掉帧和卡顿现象
  - 自动适配设备刷新率（60Hz/90Hz/120Hz/144Hz）
  - 低性能设备上可降级到 60 FPS 但保持流畅

### 3.3 稳定性
- 应用不应出现崩溃
- 异常情况下能够正确恢复
- 长时间运行保持稳定

### 3.4 兼容性
- 支持不同屏幕尺寸和分辨率
- 适配深色/浅色主题
- 向后兼容旧版本数据

### 3.5 安全性
- 本地数据加密存储（用户隐私信息）
- 网络请求使用 HTTPS
- 不收集用户敏感信息

---

## 4. 技术架构建议

### 4.1 开发技术栈

#### 4.1.1 跨平台方案选择
**方案一：Flutter（推荐）**
- 优点：一套代码双端运行、性能好、UI美观、开发效率高
- 缺点：包体积较大

**方案二：React Native**
- 优点：前端技术栈、社区活跃
- 缺点：Windows 支持需要额外配置

**方案三：Electron + Android 原生**
- 优点：Windows 端功能强大
- 缺点：需要维护两套代码

#### 4.1.2 推荐技术栈（基于 Flutter）
- **前端框架**: Flutter 3.x
- **状态管理**: Provider / Riverpod / GetX
- **音频播放**: just_audio (跨平台音频库)
- **本地存储**: sqflite (SQLite 数据库)
- **网络请求**: dio
- **本地缓存**: shared_preferences、hive
- **音乐信息读取**: flutter_audio_metadata
- **动画库**:
  - Flutter 内置 Animation API
  - animations (官方动画包，提供预设的页面过渡动画)
  - flutter_animate (声明式动画库)
  - rive (矢量动画，用于复杂动画场景)
- **性能优化**:
  - flutter_performance (性能监控)
  - 使用 RepaintBoundary 隔离动画区域
  - 使用 const 构造函数减少重建
  - 开启高刷新率支持（Flutter 3.x+ 原生支持）
  - 使用 Impeller 渲染引擎（iOS）提升性能
  - 避免在 build 方法中执行耗时操作
  - 使用 ListView.builder 等懒加载组件

### 4.2 架构设计

#### 4.2.1 分层架构
```
├── Presentation Layer (UI层)
│   ├── Pages (页面)
│   ├── Widgets (组件)
│   └── Themes (主题)
│
├── Business Logic Layer (业务逻辑层)
│   ├── State Management (状态管理)
│   ├── Services (服务)
│   └── Use Cases (用例)
│
├── Data Layer (数据层)
│   ├── Models (数据模型)
│   ├── Repositories (仓库)
│   └── Data Sources (数据源)
│       ├── Local (本地)
│       └── Remote (远程)
│
└── Core (核心)
    ├── Utils (工具类)
    ├── Constants (常量)
    └── Extensions (扩展)
```

#### 4.2.2 核心模块
- **音频播放模块**: 封装播放控制、队列管理
- **音乐库模块**: 扫描、索引、分类管理
- **在线音乐模块**: 搜索、下载、API 对接
- **歌词模块**: 获取、解析、显示歌词
- **同步模块**: 跨设备数据同步
- **存储模块**: 数据库操作、文件管理
- **动画模块**: 统一管理应用内所有动画效果
  - 页面过渡动画控制器
  - 列表项动画（进入、退出、重排序）
  - 播放器控制动画（播放按钮、进度条等）
  - 手势动画处理
  - 性能监控和优化

### 4.3 数据存储

#### 4.3.1 本地数据库（SQLite）
- **Songs 表**: 存储歌曲信息
- **Playlists 表**: 存储播放列表
- **PlaylistSongs 表**: 播放列表与歌曲关联
- **PlayHistory 表**: 播放历史
- **Settings 表**: 用户设置

#### 4.3.2 文件存储
- 音乐文件（用户本地）
- 下载的音乐文件
- 专辑封面缓存
- 歌词文件缓存

#### 4.3.3 云端存储（可选）
- 用户数据同步
- 播放列表备份

---

## 5. 开发计划

### 5.1 第一阶段：MVP (最小可行产品)
**目标**: 实现基础播放功能
- 本地音乐扫描和播放
- 基础播放控制（播放、暂停、切歌）
- 简单的播放列表
- 基础 UI 界面

**时间**: 4-6 周

### 5.2 第二阶段：核心功能完善
**目标**: 完善音乐管理功能
- 播放列表完整功能
- 音乐分类管理
- 收藏功能
- 搜索功能
- 主题切换

**时间**: 4-6 周

### 5.3 第三阶段：在线功能
**目标**: 实现在线音乐功能
- 在线搜索
- 在线播放
- 音乐下载
- 歌词显示

**时间**: 6-8 周

### 5.4 第四阶段：优化和跨平台特性
**目标**: 平台特定功能和优化
- Windows 平台特性
- Android 平台特性
- 数据同步
- 性能优化
- Bug 修复

**时间**: 4-6 周

### 5.5 第五阶段：测试和发布
**目标**: 全面测试和发布
- 功能测试
- 性能测试
- 用户体验优化
- 文档完善
- 正式发布

**时间**: 2-4 周

---

## 6. 风险与挑战

### 6.1 技术风险
- **跨平台兼容性**: 不同平台的 API 差异需要适配
- **音频格式支持**: 某些格式可能需要额外的解码器
- **性能优化**: 大量歌曲时的流畅度问题

### 6.2 法律风险
- **版权问题**: 在线音乐的版权需要注意
- **API 使用**: 第三方音乐平台 API 的使用限制

### 6.3 解决方案
- 充分调研和测试跨平台方案
- 使用成熟的音频处理库
- 仅提供搜索和链接，不存储版权内容
- 遵守各平台的使用条款

---

## 7. 未来扩展

### 7.1 可能的功能扩展
- iOS 平台支持
- macOS 平台支持
- Web 版本
- 社交功能（分享歌单、好友推荐）
- 智能推荐算法
- 音乐识别（听歌识曲）
- 云盘功能
- 播客支持
- 电台功能

### 7.2 商业化方向
- 高级会员功能
- 无损音乐下载
- 云端存储空间
- 去广告

---

## 8. 总结

FLMusic 旨在打造一款简洁、美观、功能完善的跨平台音乐播放器。通过合理的技术选型和架构设计，实现 Windows 和 Android 双端统一的用户体验。项目将分阶段开发，先实现核心功能，再逐步完善和优化。

**核心目标**:
1. 优秀的用户体验
2. 稳定的性能表现
3. 跨平台统一体验
4. 持续迭代优化

---

## 附录

### A. 参考竞品
- 网易云音乐
- QQ 音乐
- Spotify
- Apple Music
- foobar2000 (Windows)
- Musicolet (Android)

### B. 相关文档
- [技术架构文档](./architecture.md) (待创建)
- [API 设计文档](./api-design.md) (待创建)
- [UI 设计规范](./ui-design.md) (待创建)
- [开发规范](./development-guide.md) (待创建)

### C. 更新日志
- 2026-01-20: 初始版本需求文档创建
- 2026-01-20: 新增动画与交互详细需求，强化流畅性要求
  - 添加 2.4.4 节：动画与交互功能需求
  - 更新 3.2 节：增加动画流畅性的具体性能指标
  - 更新 4.1.2 节：增加动画相关技术栈和库
  - 更新 4.2.2 节：新增动画模块架构设计
- 2026-01-20: 提升帧率要求至 120 FPS
  - 更新动画性能目标从 60 FPS 提升至 120 FPS
  - 新增高刷新率屏幕支持（60/90/120/144Hz 自适应）
  - 优化手势操作延迟要求至 < 8ms
  - 添加设备性能自适应降级机制
